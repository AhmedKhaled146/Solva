<% inside_thread = local_assigns.fetch(:inside_thread, false) %>

<turbo-frame id="message_<%= message.id %>">
  <div class="group flex items-start space-x-3 p-2 hover:bg-yellow-600 rounded-lg transition-colors duration-150" id="message-<%= message.id %>" data-message-id="<%= message.id %>">
    <!-- Avatar -->
    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white">
      <%= message.user.email.first.upcase %>
    </div>

    <!-- Message content + meta -->
    <div class="flex-1">
      <div class="flex items-center space-x-2">
        <span class="text-sm font-semibold"><%= message.user.email %></span>
        <span class="text-xs text-gray-400"><%= message.created_at.strftime("%H:%M") %></span>
      </div>

      <p class="text-sm text-gray-900">
        <%= message.body %>
      </p>
    </div>

    <!-- Actions -->
    <% unless inside_thread %>
      <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-150">
        <!-- Show thread button -->
        <%= link_to workspace_channel_message_path(message.channel.workspace, message.channel, message),
                    data: { turbo_frame: "message_thread" },
                    onclick: "document.getElementById('message_thread').classList.remove('hidden')",
                    class: "p-1 rounded hover:bg-gray-200 focus:outline-none" do %>
          <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        <% end %>
      </div>
    <% end %>
  </div>
</turbo-frame>