<%= turbo_frame_tag "reply_form_#{message.id}" do %>
  <%= form_with(model: [workspace, channel, message, reply],
                class: "space-y-3") do |f| %>

    <div class="flex items-start space-x-3">
      <!-- User Avatar -->
      <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center text-white font-medium text-sm">
        <% current_user = local_assigns.fetch(:current_user, defined?(current_user) ? current_user : nil) %>
        <%= current_user ? current_user.email.first.upcase : 'U' %>
      </div>

      <div class="flex-1">
        <div class="relative">
          <%= f.text_area :body,
                          rows: 2,
                          placeholder: "Reply to this thread...",
                          class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm resize-none",
                          onkeydown: "if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); this.form.submit(); }" %>

          <!-- Character counter -->
          <div class="absolute bottom-1 right-1 text-xs text-gray-400" id="char-count"></div>
        </div>

        <div class="flex items-center justify-between mt-2">
          <p class="text-xs text-gray-500">Shift+Enter for new line, Enter to send</p>

          <div class="flex items-center space-x-2">
            <%= f.button type: "submit",
                         class: "inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-150" do %>
              <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
              </svg>
              Reply
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>